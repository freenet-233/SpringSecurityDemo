mode:
  type: Standalone
  repository:
    type: JDBC
databaseName: aya_db
dataSources:
  ds_aya_basic:
    dataSourceClassName: com.alibaba.druid.pool.DruidDataSource
    driverClassName: org.postgresql.Driver
    url: jdbc:postgresql://127.0.0.1:5433/aya_basic
    username: postgres
    password: iDtU7OG+pSIRUKZR4oHIqg4ApomOt8NhPafBHJ9i9WZMKnsoLR3oj19M8CvRnNVzZGqy4S8iVFQQ/xDyaBeK6w==
    initialSize: 1
    minIdle: 1
    maxActive: 64
    maxWait: 20000
    validationQuery: SELECT 1
    validationQueryTimeout: 30000
    minEvictableIdleTimeMillis: 300000
    maxEvictableIdleTimeMillis: 600000
    timeBetweenEvictionRunsMillis: 300000
    testOnBorrow: true
    testWhileIdle: true
    filters: config, stat, wall
    connectProperties:
      connectTimeout: 5000
      socketTimeout: '20000'
      config.decrypt: 'true'
      config.decrypt.key: MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAJ05kvOTSV2shvQ/nK632kXMe10o1fNcu+cA6TAYEh2bxhjnJ4DAoqooSpPhgjCGtzjpGhglrcMryq/olbDOOXMCAwEAAQ==

  ds_aya_0000:
    dataSourceClassName: com.alibaba.druid.pool.DruidDataSource
    driverClassName: org.postgresql.Driver
    url: jdbc:postgresql://127.0.0.1:5433/aya_0000
    username: postgres
    password: iDtU7OG+pSIRUKZR4oHIqg4ApomOt8NhPafBHJ9i9WZMKnsoLR3oj19M8CvRnNVzZGqy4S8iVFQQ/xDyaBeK6w==
    initialSize: 1
    minIdle: 1
    maxActive: 64
    maxWait: 20000
    validationQuery: SELECT 1
    validationQueryTimeout: 30000
    minEvictableIdleTimeMillis: 300000
    maxEvictableIdleTimeMillis: 600000
    timeBetweenEvictionRunsMillis: 300000
    testOnBorrow: true
    testWhileIdle: true
    filters: config, stat, wall
    connectProperties:
      connectTimeout: 5000
      socketTimeout: '20000'
      config.decrypt: 'true'
      config.decrypt.key: MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAJ05kvOTSV2shvQ/nK632kXMe10o1fNcu+cA6TAYEh2bxhjnJ4DAoqooSpPhgjCGtzjpGhglrcMryq/olbDOOXMCAwEAAQ==

  ds_aya_0001:
    dataSourceClassName: com.alibaba.druid.pool.DruidDataSource
    driverClassName: org.postgresql.Driver
    url: jdbc:postgresql://127.0.0.1:5433/aya_0001
    username: postgres
    password: iDtU7OG+pSIRUKZR4oHIqg4ApomOt8NhPafBHJ9i9WZMKnsoLR3oj19M8CvRnNVzZGqy4S8iVFQQ/xDyaBeK6w==
    initialSize: 1
    minIdle: 1
    maxActive: 64
    maxWait: 20000
    validationQuery: SELECT 1
    validationQueryTimeout: 30000
    minEvictableIdleTimeMillis: 300000
    maxEvictableIdleTimeMillis: 600000
    timeBetweenEvictionRunsMillis: 300000
    testOnBorrow: true
    testWhileIdle: true
    filters: config, stat, wall
    connectProperties:
      connectTimeout: 5000
      socketTimeout: '20000'
      config.decrypt: 'true'
      config.decrypt.key: MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAJ05kvOTSV2shvQ/nK632kXMe10o1fNcu+cA6TAYEh2bxhjnJ4DAoqooSpPhgjCGtzjpGhglrcMryq/olbDOOXMCAwEAAQ==

  ds_aya_0000_slave1:
    dataSourceClassName: com.alibaba.druid.pool.DruidDataSource
    driverClassName: org.postgresql.Driver
    url: jdbc:postgresql://127.0.0.1:5433/aya_0000_slave1
    username: postgres
    password: iDtU7OG+pSIRUKZR4oHIqg4ApomOt8NhPafBHJ9i9WZMKnsoLR3oj19M8CvRnNVzZGqy4S8iVFQQ/xDyaBeK6w==
    initialSize: 1
    minIdle: 1
    maxActive: 64
    maxWait: 20000
    validationQuery: SELECT 1
    validationQueryTimeout: 30000
    minEvictableIdleTimeMillis: 300000
    maxEvictableIdleTimeMillis: 600000
    timeBetweenEvictionRunsMillis: 300000
    testOnBorrow: true
    testWhileIdle: true
    filters: config, stat, wall
    connectProperties:
      connectTimeout: 5000
      socketTimeout: '20000'
      config.decrypt: 'true'
      config.decrypt.key: MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAJ05kvOTSV2shvQ/nK632kXMe10o1fNcu+cA6TAYEh2bxhjnJ4DAoqooSpPhgjCGtzjpGhglrcMryq/olbDOOXMCAwEAAQ==

  ds_aya_0001_slave1:
    dataSourceClassName: com.alibaba.druid.pool.DruidDataSource
    driverClassName: org.postgresql.Driver
    url: jdbc:postgresql://127.0.0.1:5433/aya_0001_slave1
    username: postgres
    password: iDtU7OG+pSIRUKZR4oHIqg4ApomOt8NhPafBHJ9i9WZMKnsoLR3oj19M8CvRnNVzZGqy4S8iVFQQ/xDyaBeK6w==
    initialSize: 1
    minIdle: 1
    maxActive: 64
    maxWait: 20000
    validationQuery: SELECT 1
    validationQueryTimeout: 30000
    minEvictableIdleTimeMillis: 300000
    maxEvictableIdleTimeMillis: 600000
    timeBetweenEvictionRunsMillis: 300000
    testOnBorrow: true
    testWhileIdle: true
    filters: config, stat, wall
    connectProperties:
      connectTimeout: 5000
      socketTimeout: '20000'
      config.decrypt: 'true'
      config.decrypt.key: MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAJ05kvOTSV2shvQ/nK632kXMe10o1fNcu+cA6TAYEh2bxhjnJ4DAoqooSpPhgjCGtzjpGhglrcMryq/olbDOOXMCAwEAAQ==

  ds_aya_0000_slave2:
    dataSourceClassName: com.alibaba.druid.pool.DruidDataSource
    driverClassName: org.postgresql.Driver
    url: jdbc:postgresql://127.0.0.1:5433/aya_0000_slave2
    username: postgres
    password: iDtU7OG+pSIRUKZR4oHIqg4ApomOt8NhPafBHJ9i9WZMKnsoLR3oj19M8CvRnNVzZGqy4S8iVFQQ/xDyaBeK6w==
    initialSize: 1
    minIdle: 1
    maxActive: 64
    maxWait: 20000
    validationQuery: SELECT 1
    validationQueryTimeout: 30000
    minEvictableIdleTimeMillis: 300000
    maxEvictableIdleTimeMillis: 600000
    timeBetweenEvictionRunsMillis: 300000
    testOnBorrow: true
    testWhileIdle: true
    filters: config, stat, wall
    connectProperties:
      connectTimeout: 5000
      socketTimeout: '20000'
      config.decrypt: 'true'
      config.decrypt.key: MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAJ05kvOTSV2shvQ/nK632kXMe10o1fNcu+cA6TAYEh2bxhjnJ4DAoqooSpPhgjCGtzjpGhglrcMryq/olbDOOXMCAwEAAQ==

  ds_aya_0001_slave2:
    dataSourceClassName: com.alibaba.druid.pool.DruidDataSource
    driverClassName: org.postgresql.Driver
    url: jdbc:postgresql://127.0.0.1:5433/aya_0001_slave2
    username: postgres
    password: iDtU7OG+pSIRUKZR4oHIqg4ApomOt8NhPafBHJ9i9WZMKnsoLR3oj19M8CvRnNVzZGqy4S8iVFQQ/xDyaBeK6w==
    initialSize: 1
    minIdle: 1
    maxActive: 64
    maxWait: 20000
    validationQuery: SELECT 1
    validationQueryTimeout: 30000
    minEvictableIdleTimeMillis: 300000
    maxEvictableIdleTimeMillis: 600000
    timeBetweenEvictionRunsMillis: 300000
    testOnBorrow: true
    testWhileIdle: true
    filters: config, stat, wall
    connectProperties:
      connectTimeout: 5000
      socketTimeout: '20000'
      config.decrypt: 'true'
      config.decrypt.key: MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAJ05kvOTSV2shvQ/nK632kXMe10o1fNcu+cA6TAYEh2bxhjnJ4DAoqooSpPhgjCGtzjpGhglrcMryq/olbDOOXMCAwEAAQ==


rules:
# 数据分片
- !SHARDING
    tables:
      t_claim_case_info:
        actualDataNodes: ds_aya_000$->{0..1}.t_claim_case_info_000$->{0..4}
        tableStrategy:
          standard:
            shardingColumn: transaction_no
            shardingAlgorithmName: t_claim_case_info_inline
        keyGenerateStrategy:
          column: id
          keyGeneratorName: snowflake
      t_individual_authorization_management:
        actualDataNodes: ds_aya_000$->{0..1}.t_individual_authorization_management_000$->{0..4}
        databaseStrategy:
          standard:
            shardingColumn: auth_code
            shardingAlgorithmName: t_individual_authorization_management_db_inline
        tableStrategy:
          standard:
            shardingColumn: auth_code
            shardingAlgorithmName: t_individual_authorization_management_inline
        keyGenerateStrategy:
          column: id
          keyGeneratorName: snowflake

    defaultShardingColumn: transaction_no
    bindingTables:
      - t_claim_case_info, t_individual_authorization_management
    defaultDatabaseStrategy:
      standard:
        shardingColumn: transaction_no
        shardingAlgorithmName: database_inline
    defaultTableStrategy:
      none:
    shardingAlgorithms:
      database_inline:
        type: INLINE
        props:
          algorithm-expression: ds_aya_$->{transaction_no[-8..-5]}

      t_individual_authorization_management_db_inline:
        type: INLINE
        props:
          algorithm-expression: ds_aya_$->{auth_code[-8..-5]}

      t_claim_case_info_inline:
        type: INLINE
        props:
          algorithm-expression: t_claim_case_info_$->{transaction_no[-4..-1]}

      t_individual_authorization_management_inline:
        type: INLINE
        props:
          algorithm-expression: t_individual_authorization_management_$->{auth_code[-4..-1]}
    keyGenerators:
      snowflake:
        type: RANDOM_WORKER_ID_SNOWFLAKE

#数据加密
- !ENCRYPT
  tables:
    t_claim_case_info:
      columns:
        mobile_no:
          cipher:
            name: mobile_no
            encryptorName: sm4_encryptor

  encryptors:
    sm4_encryptor:
      type: SM4
      props:
        sm4-key: 86C63180C2806ED1F43A859DE501215C
        sm4-mode: ECB
        sm4-padding: PKCS5Padding
# 单表
- !SINGLE
  tables:
    - ds_aya_basic.*

# 读写分离
- !READWRITE_SPLITTING
  dataSourceGroups:
    ds_aya_0000:
      writeDataSourceName: ds_aya_0000
      readDataSourceNames:
        - ds_aya_0000_slave1
        - ds_aya_0000_slave2
      transactionalReadQueryStrategy: PRIMARY
      loadBalancerName: random
    ds_aya_0001:
      writeDataSourceName: ds_aya_0001
      readDataSourceNames:
        - ds_aya_0001_slave1
        - ds_aya_0001_slave2
      transactionalReadQueryStrategy: PRIMARY
      loadBalancerName: random
  loadBalancers:
    random:
      type: RANDOM


props:
  sql-show: true
  max-connections-size-per-query: 5

